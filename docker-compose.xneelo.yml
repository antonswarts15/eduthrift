# Xneelo Cloud Deployment - Uses pre-built images from GitHub Container Registry
version: '3.8'

services:
  # Backend API
  backend:
    image: ghcr.io/antonswarts15/eduthrift-backend:latest
    container_name: eduthrift-backend
    restart: unless-stopped
    environment:
      NODE_ENV: production
      DB_HOST: ${DB_HOST:-localhost}
      DB_PORT: ${DB_PORT:-3306}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME:-eduthrift}
      JWT_SECRET: ${JWT_SECRET}
      PORT: 8080
      FRONTEND_URL: http://154.65.107.50:3000
      PAYFAST_MERCHANT_ID: ${PAYFAST_MERCHANT_ID}
      PAYFAST_MERCHANT_KEY: ${PAYFAST_MERCHANT_KEY}
      PAYFAST_PASSPHRASE: ${PAYFAST_PASSPHRASE}
      PAYFAST_URL: ${PAYFAST_URL:-https://www.payfast.co.za/eng/process}
      PUDO_API_KEY: ${PUDO_API_KEY}
      PUDO_API_URL: ${PUDO_API_URL:-https://api.pudo.co.za}
    ports:
      - "8080:8080"
    volumes:
      - backend_uploads:/app/uploads
    networks:
      - eduthrift-network

  # Frontend
  frontend:
    image: ghcr.io/antonswarts15/eduthrift-frontend:latest
    container_name: eduthrift-frontend
    restart: unless-stopped
    ports:
      - "3000:80"
    networks:
      - eduthrift-network

  # Admin Panel
  admin:
    image: ghcr.io/antonswarts15/eduthrift-admin:latest
    container_name: eduthrift-admin
    restart: unless-stopped
    ports:
      - "3001:80"
    networks:
      - eduthrift-network

volumes:
  backend_uploads:

networks:
  eduthrift-network:
    driver: bridge
